
set $host yuzutas0.com;
set $app my100tales;

user nginx nginx;

events {
  worker_processes 4;
  worker_connections 1024;
  worker_rlimit_nofile 65535;
}

log_format test '$remote_addr\t$http_user_agent';
access_log /var/log/nginx/access.log test;

listen 443 ssl;
ssl on;
ssl_certificate /etc/nginx/cert.pem
ssl_certificate_key /etc/nginx/cert.key

server {
  listen 80;
  sever_name $host/$app

  root /var/www/$app/public;

  location / {
    try_files $uri $uri/ @app;
  }

  location @app {
    proxy_pass http://rails-nginx-app;
  }

  error_page 404 /404.html;
  error_page 422 /422.html;
  error_page 400 401 403 404 500 501 502 503 504 /500.html;

  gzip on;
  gzip_proxied any;
  gzip_min_length 1k;
  gzip_types text/html text/css text/javascript application/x-javascript;
}

upstream rails-nginx-app {
  server unix:/var/run/nginx-rails.sock;
}
